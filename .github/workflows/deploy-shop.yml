# ì›Œí¬í”Œë¡œìš° ì´ë¦„
name: Deploy shop to GitHub Pages

# ì–¸ì œ ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í• ì§€ ê²°ì •
on:
  push:
    branches:
      - shop # 'shop' ë¸Œëœì¹˜ì— push ë  ë•Œë§Œ ì‹¤í–‰

# ì›Œí¬í”Œë¡œìš°ì— í•„ìš”í•œ ê¶Œí•œ ì„¤ì •
# gh-pages ë¸Œëœì¹˜ì— push í•  ìˆ˜ ìˆë„ë¡ ì“°ê¸° ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
permissions:
  contents: write

# ì‹¤ì œ ì‘ì—…(Job) ì •ì˜
jobs:
  build-and-deploy:
    # ì‘ì—… ì´ë¦„
    name: Build and Deploy shop
    # ì‘ì—…ì´ ì‹¤í–‰ë  ê°€ìƒ í™˜ê²½
    runs-on: ubuntu-latest

    # ì‘ì—… ë‹¨ê³„(Step)ë“¤
    steps:
      # 1. ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      # 2. Node.js í™˜ê²½ ì„¤ì •
      - name: Setup Node.js ğŸŸ©
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: npm
          # ìºì‹œ ëŒ€ìƒì„ shop í”„ë¡œì íŠ¸ì˜ lock íŒŒì¼ë¡œ ì •í™•íˆ ì§€ì •
          cache-dependency-path: ./shop/package-lock.json

      # 3. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜ (shop í´ë”ë¡œ ì´ë™í•´ì„œ ì‹¤í–‰)
      - name: Install dependencies ğŸ“¦
        working-directory: ./shop
        run: npm ci

      # 4. í”„ë¡œì íŠ¸ ë¹Œë“œ (shop í´ë”ë¡œ ì´ë™í•´ì„œ ì‹¤í–‰)
      - name: Build project ğŸ—ï¸
        working-directory: ./shop
        run: npm run build

      # 5. ë¹Œë“œ ê²°ê³¼ë¬¼ì„ gh-pages ë¸Œëœì¹˜ì— ë°°í¬
      - name: Deploy to gh-pages branch ğŸš€
        uses: peaceiris/actions-gh-pages@v4
        with:
          # ë°°í¬ë¥¼ ìœ„í•œ ì¸ì¦ í† í°
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # ë°°í¬í•  ë¸Œëœì¹˜ ì´ë¦„
          publish_branch: gh-pages
          # ë°°í¬í•  í´ë” (ë¹Œë“œ ê²°ê³¼ë¬¼ ê²½ë¡œ)
          publish_dir: ./shop/dist
          # ë°°í¬ë  ëª©ì ì§€ í•˜ìœ„ í´ë” ì§€ì •
          destination_dir: ./shop
          # ë‹¤ë¥¸ í”„ë¡œì íŠ¸ íŒŒì¼ì„ ì‚­ì œí•˜ì§€ ì•Šê³  ìœ ì§€
          keep_files: true