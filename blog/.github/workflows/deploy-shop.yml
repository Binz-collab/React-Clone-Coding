# ì›Œí¬í”Œë¡œìš°ì˜ ì´ë¦„
name: Deploy shop to GitHub Pages

# ì–¸ì œ ì´ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í• ì§€ ê²°ì •
on:
  push:
    branches:
      - shop  # 'shop' ë¸Œëœì¹˜ì— push ë  ë•Œë§Œ ì‹¤í–‰

# ì›Œí¬í”Œë¡œìš°ì— í•„ìš”í•œ ê¶Œí•œ ì„¤ì •
permissions:
  contents: read  # ì €ì¥ì†Œì˜ ë‚´ìš©ì„ ì½ì„ ìˆ˜ ìˆëŠ” ê¶Œí•œ
  pages: write      # pagesì— ë°°í¬í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ
  id-token: write   # ì¸ì¦ì„ ìœ„í•œ í† í° ê¶Œí•œ

# ì‹¤ì œ ì‘ì—…(Job) ì •ì˜
jobs:
  build:
    runs-on: ubuntu-latest
    
    # ì‘ì—… ë‹¨ê³„(Step)ë“¤
    steps:
      # 1. ì†ŒìŠ¤ ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4

      # 2. Node.js í™˜ê²½ ì„¤ì • (React ë¹Œë“œë¥¼ ìœ„í•´ í•„ìš”)
      - name: Setup Node.js ğŸŸ©
        uses: actions/setup-node@v4
        with:
          node-version: '20'   # Node.js ë²„ì „
          cache: 'npm'         # npm ìºì‹±ìœ¼ë¡œ ì†ë„ í–¥ìƒ

      # 3. ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜
      - name: Install dependencies ğŸ“¦
        run: npm ci

      # 4. í”„ë¡œì íŠ¸ ë¹Œë“œ (vite.config.jsì˜ base ì„¤ì •ì´ ì—¬ê¸°ì„œ ì‚¬ìš©ë¨)
      - name: Build project ğŸ—ï¸
        # vite.config.jsì— base: '/[ì €ì¥ì†Œì´ë¦„]/[ë¸Œëœì¹˜ì´ë¦„]/'ìœ¼ë¡œ ì„¤ì •ì´ ë˜ì–´ ìˆì–´ì•¼ í•¨
        run: npm run build

      - name: Upload artifact â¬†ï¸
        uses: actions/upload-pages-artifact@v3
        with:
          # dist í´ë”ë¥¼ shop ë¼ëŠ” ì´ë¦„ì˜ artifactë¡œ ì—…ë¡œë“œ
          path: ./dist
          name: shop-artifact

      # ë°°í¬ ì‘ì—…
    deploy:
      needs: build # build ì‘ì—…ì´ ì„±ê³µí•´ì•¼ ì‹¤í–‰ë¨
      runs-on: ubuntu-latest
      environment:
        name: github-pages
        url: ${{ steps.deployment.outputs.page_url }}/shop # ë°°í¬ë  ìµœì¢… URL
      steps:
        - name: Deploy to GitHub Pages ğŸš€
          id: deployment
          uses: actions/deploy-pages@v4
          with:
            artifact_name: shop-artifact